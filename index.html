<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hysilens Violin Player</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <header>
            <h1>ðŸŽ» Hysilens Violin Player</h1>
            <p class="subtitle">Motion-controlled music playback</p>
        </header>

        <main>
            <!-- Connection Section -->
            <section class="card connection-section">
                <h2>Bluetooth Connection</h2>
                <div class="status-row">
                    <span class="status-label">Status:</span>
                    <span id="connectionStatus" class="status-value">Disconnected</span>
                </div>
                <div class="button-group">
                    <button id="connectBtn" class="btn btn-primary">Connect Arduino</button>
                    <button id="disconnectBtn" class="btn btn-secondary" disabled>Disconnect</button>
                </div>
            </section>

            <!-- IMU Data Display -->
            <section class="card imu-section" id="imuSection" style="display: none;">
                <h2>IMU Data</h2>
                <div class="data-grid">
                    <div class="data-column">
                        <h3>Accelerometer</h3>
                        <div class="data-item">
                            <span class="label">X:</span>
                            <span id="accelX">0.00</span>
                        </div>
                        <div class="data-item">
                            <span class="label">Y:</span>
                            <span id="accelY">0.00</span>
                        </div>
                        <div class="data-item">
                            <span class="label">Z:</span>
                            <span id="accelZ">0.00</span>
                        </div>
                    </div>
                    <div class="data-column">
                        <h3>Gyroscope</h3>
                        <div class="data-item">
                            <span class="label">X:</span>
                            <span id="gyroX">0.00</span>
                        </div>
                        <div class="data-item">
                            <span class="label">Y:</span>
                            <span id="gyroY">0.00</span>
                        </div>
                        <div class="data-item">
                            <span class="label">Z:</span>
                            <span id="gyroZ">0.00</span>
                        </div>
                    </div>
                </div>
                <div class="motion-speed">
                    <span class="label">Motion Speed:</span>
                    <span id="motionSpeed">0.00</span>
                    <div class="progress-bar">
                        <div id="motionProgress" class="progress-fill"></div>
                    </div>
                </div>
                <div class="bow-direction">
                    <span class="label">Bow Direction:</span>
                    <span id="bowDirection" class="direction-value">Unknown</span>
                    <span id="directionChange" class="direction-badge" style="display: none;">CHANGE</span>
                </div>
                <div class="raw-output">
                    <h3>Raw Output Stream:</h3>
                    <div id="rawOutput" class="raw-output-box"></div>
                </div>
            </section>

            <!-- Playback Controls -->
            <section class="card playback-section">
                <h2>Playback Control</h2>

                <!-- Playback Mode -->
                <div class="control-group">
                    <div class="control-row">
                        <span class="label">Playback Mode:</span>
                        <button id="playbackModeBtn" class="btn btn-mode">MP3</button>
                    </div>
                </div>

                <div class="divider"></div>

                <!-- MP3 Track Selection -->
                <div class="control-group">
                    <div class="control-row">
                        <span class="label">Current Track:</span>
                        <span id="trackName" class="track-name">No Track</span>
                    </div>
                    <div class="button-group-full">
                        <button id="selectFileBtn" class="btn btn-secondary">Select MP3 File</button>
                        <button id="builtInTracksBtn" class="btn btn-secondary">Built-in Tracks</button>
                    </div>
                    <input type="file" id="fileInput" accept="audio/mp3,audio/mpeg" style="display: none;">
                </div>

                <!-- MIDI File Selection (shown in MIDI mode) -->
                <div id="midiControls" class="control-group" style="display: none;">
                    <div class="divider"></div>

                    <div class="control-row">
                        <span class="label">MIDI File:</span>
                        <span id="midiFileName" class="track-name">No MIDI File</span>
                    </div>
                    <div class="button-group-full">
                        <button id="selectMidiBtn" class="btn btn-secondary">Select MIDI File</button>
                        <button id="builtInMidiBtn" class="btn btn-secondary">Built-in MIDI Files</button>
                    </div>
                    <input type="file" id="midiFileInput" accept=".mid,.midi" style="display: none;">

                    <div class="divider"></div>

                    <div class="control-row">
                        <span class="label">Current Note:</span>
                        <span id="currentNote" class="track-name">1/0</span>
                    </div>
                </div>

                <div class="divider"></div>

                <!-- Playback Controls -->
                <div class="control-group">
                    <div class="button-group-full">
                        <button id="imuPlaybackBtn" class="btn btn-toggle active">Pause IMU Playback</button>
                        <button id="testPlaybackBtn" class="btn btn-secondary">Test Playback (Preview)</button>
                    </div>
                </div>

                <div class="divider"></div>

                <!-- Playback Position -->
                <div class="control-group">
                    <div class="time-display">
                        <span id="currentTime">0:00</span>
                        <span id="duration">0:00</span>
                    </div>
                    <input type="range" id="seekSlider" class="seek-slider" min="0" max="100" value="0">
                </div>
            </section>

            <!-- Volume Controls -->
            <section class="card volume-section">
                <h2>Audio Control</h2>

                <!-- Max Volume -->
                <div class="control-group">
                    <div class="slider-control">
                        <label for="maxVolumeSlider">Max Volume: <span id="maxVolumeValue">100</span>%</label>
                        <input type="range" id="maxVolumeSlider" class="slider" min="0" max="100" value="100">
                    </div>
                </div>

                <div class="divider"></div>

                <!-- Arduino Volume Feedback Toggle -->
                <div class="control-group">
                    <div class="toggle-control">
                        <div class="toggle-header">
                            <label for="arduinoVolumeFeedbackToggle">Arduino Volume Feedback</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="arduinoVolumeFeedbackToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <p class="toggle-description">Send volume level to Arduino (0-100%)</p>
                    </div>
                </div>

                <!-- Arduino Max Volume Scale -->
                <div class="control-group">
                    <div class="slider-control">
                        <label for="arduinoMaxVolumeSlider">Arduino Max Volume Scale: <span id="arduinoMaxVolumeValue">100</span>%</label>
                        <p class="slider-description">Scale the volume sent to Arduino (50% = scale by 0.5)</p>
                        <input type="range" id="arduinoMaxVolumeSlider" class="slider" min="0" max="100" value="100">
                    </div>
                </div>

                <div class="divider"></div>

                <!-- Motion Threshold -->
                <div class="control-group">
                    <div class="slider-control">
                        <label for="motionThresholdSlider">Motion Threshold: <span id="motionThresholdValue">15</span>%</label>
                        <p class="slider-description">Motion speed needed to play audio (MP3 or MIDI)</p>
                        <input type="range" id="motionThresholdSlider" class="slider" min="0" max="100" value="15">
                    </div>
                </div>

                <div class="divider"></div>

                <!-- Current Volume Display -->
                <div class="control-group">
                    <div class="volume-display">
                        <span class="label">Current Output Volume: <span id="currentVolumeValue">0</span>%</span>
                        <div class="progress-bar">
                            <div id="volumeProgress" class="progress-fill progress-secondary"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Built-in Tracks Modal -->
            <div id="tracksModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>Select Built-in Track</h2>
                        <button class="close-btn" id="closeTracksModal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div id="tracksList" class="tracks-list"></div>
                    </div>
                </div>
            </div>

            <!-- Built-in MIDI Files Modal -->
            <div id="midiModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>Select Built-in MIDI File</h2>
                        <button class="close-btn" id="closeMidiModal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div id="midiList" class="tracks-list"></div>
                    </div>
                </div>
            </div>

            <!-- Service Selector Modal -->
            <div id="serviceModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>Select Characteristic</h2>
                        <p class="modal-subtitle">Choose a characteristic to subscribe to</p>
                        <button class="close-btn" id="closeServiceModal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div id="servicesList" class="services-list"></div>
                    </div>
                </div>
            </div>

            <!-- Console Log Viewer -->
            <section class="card console-section">
                <div class="console-header">
                    <h2>Console Log</h2>
                    <div class="console-controls">
                        <button id="clearConsoleBtn" class="btn btn-secondary btn-small">Clear</button>
                        <button id="toggleConsoleBtn" class="btn btn-secondary btn-small">Collapse</button>
                    </div>
                </div>
                <div id="consoleOutput" class="console-output"></div>
            </section>
        </main>

        <footer>
            <p>Hysilens Violin Player - Web Edition</p>
            <p class="disclaimer">Requires Chrome/Edge with Web Bluetooth API support</p>
        </footer>
    </div>

    <script src="assets/manifest.js"></script>
    <script src="app.js"></script>
</body>
</html>

